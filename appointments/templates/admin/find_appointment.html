{% extends 'admin/base.html' %} {% load static %} {% block title %}Student
Appointments Dashboard{% endblock %} {% block style %}
<link rel="stylesheet" href="{% static 'css/admin/find-appointment.css' %}" />
{% endblock %}
<body>
  {% block content %}
  <main class="main-content">
    <div class="appointments-container">
      <div class="appointments-header">
        <h1 class="page-title">Find Students' Appointments</h1>

        <div class="filter-controls">
          <input
            type="text"
            class="search-input"
            id="searchInput"
            placeholder="Search name, enrollment, phone, email..."
            aria-label="Search appointments"
            value="{{ request.GET.q|default:'' }}"
          />

          <input
            type="date"
            class="date-input"
            id="startDate"
            aria-label="Start date"
            value="{{ request.GET.startDate|default:'' }}"
          />

          <input
            type="date"
            class="date-input"
            id="endDate"
            aria-label="End date"
            value="{{ request.GET.endDate|default:'' }}"
          />
          <button class="primary-button" id="searchBtn"><i class="fa-solid fa-magnifying-glass"></i>Search</button>
          <button class="primary-button" id="downloadBtn">
            <i class="fas fa-download icon-spacing"></i>
            Download Data
          </button>
        </div>
      </div>

      <div class="appointments-table-container">
        <table class="appointments-table" id="appointmentsTable">
          <thead class="table-header">
            <tr>
              <th>Full Name</th>
              <th>Age</th>
              <th>Enrollment No.</th>
              <th>Department</th>
              <th>Reason</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Date</th>
              <th>Slot</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody class="table-body" id="appointmentsTableBody">
            {% for appointment in page_obj %}
            <tr class="table-row"
                  data-id="{{ appointment.id}}"
                  data-fullname="{{ appointment.fullname }}"
                  data-age="{{ appointment.age }}"
                  data-enroll_no="{{ appointment.enroll_no }}"
                  data-department="{{ appointment.department }}"
                  data-reason="{{ appointment.reason }}"
                  data-phone="{{ appointment.phone }}"
                  data-email="{{ appointment.email }}"
                  data-date="{{ appointment.date }}"
                  data-slot="{{ appointment.slot }}"
                  data-status="{{ appointment.status }}"
                  data-remarks="{{ appointment.remarks }}"
            >
              <td class="table-cell table-cell-name">{{ appointment.fullname }}</td>
              <td class="table-cell">{{ appointment.age }}</td>
              <td class="table-cell">{{ appointment.enroll_no }}</td>
              <td class="table-cell">{{ appointment.get_department_display }}</td>
              <td class="table-cell">{{ appointment.get_reason_display }}</td>
              <td class="table-cell">{{ appointment.phone }}</td>
              <td class="table-cell">{{ appointment.email }}</td>
              <td class="table-cell">{{ appointment.date|date:"Y-m-d" }}</td>
              <td class="table-cell">{{ appointment.get_slot_display }}</td>
              <td class="table-cell">
                <span class="status-badge status-{{ appointment.get_status_display|lower }}">{{ appointment.get_status_display }}</span>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="10">No appointments found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="appointments-cards">
        {% for appointment in page_obj %}
        <div class="appointment-card">
          <div class="card-header">
            <h3 class="card-name">{{ appointment.fullname }}</h3>
            <span class="status-badge status-{{ appointment.get_status_display|lower }}">{{ appointment.get_status_display }}</span>
          </div>
          <div class="card-grid">
            <div><span class="field-label">Age:</span> {{ appointment.age }}</div>
            <div class="card-field-full"><span class="field-label">Enrollment:</span> {{ appointment.enroll_no }}</div>
            <div class="card-field-full">
              <span class="field-label">Department:</span> {{ appointment.get_department_display }}
            </div>
            <div><span class="field-label">Phone:</span> {{ appointment.phone }}</div>
            <div class="card-field-full"><span class="field-label">Date:</span> {{ appointment.date|date:"Y-m-d" }}</div>
            <div class="card-field-full"><span class="field-label">Slot:</span> {{ appointment.get_slot_display }}</div>
            <div class="card-field-full">
              <span class="field-label">Reason:</span> {{ appointment.get_reason_display }}
            </div>
          </div>
        </div>
        {% empty %}
        <div class="appointment-card">
          <p>No appointments found.</p>
        </div>
        {% endfor %}
      </div>

      <div class="pagination">
        <div class="pagination-info">
          Showing <span class="pagination-number">{{ page_obj.start_index }}</span> to
          <span class="pagination-number">{{ page_obj.end_index }}</span> of
          <span class="pagination-number">{{ page_obj.paginator.count }}</span> results
        </div>
        {% if page_obj.has_other_pages %}
          <div class="pagination-controls">
            {% if page_obj.has_previous %}
            <a class="secondary-button pagination-button" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.startDate %}&startDate={{ request.GET.startDate }}{% endif %}{% if request.GET.endDate %}&endDate={{ request.GET.endDate }}{% endif %}">Previous</a>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <a class="primary-button pagination-button" class="active" href="#">{{ num }}</a>
              {% else %}
                <a class="primary-button pagination-button" href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.startDate %}&startDate={{ request.GET.startDate }}{% endif %}{% if request.GET.endDate %}&endDate={{ request.GET.endDate }}{% endif %}">{{ num }}</a>
              {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
              <a class="secondary-button pagination-button" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.startDate %}&startDate={{ request.GET.startDate }}{% endif %}{% if request.GET.endDate %}&endDate={{ request.GET.endDate }}{% endif %}">Next</a>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>
  </main>
  <!-- Edit Appointment Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>
            <div class="modal-header-icon">
              <i class="fas fa-edit"></i>
            </div>
            Edit Appointment
          </h3>
          <button type="button" class="modal-close" id="closeBtn">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="editAppointmentForm" method="POST">
            {% csrf_token %}
            <input type="hidden" name="appointment_id" id="appointment_id" value="{{ form.instance.pk|default:'' }}">
            {% if form.errors %}
              <div class="form-errors" style="border:1px solid #f5c6cb;background:#f8d7da;color:#721c24;padding:0.75rem;margin-bottom:1rem;border-radius:4px;">
                {% if form.non_field_errors %}
                  <div class="non-field-errors">
                    {% for err in form.non_field_errors %}
                      <p style="margin:0 0 .25rem;">{{ err }}</p>
                    {% endfor %}
                  </div>
                {% endif %}
                <ul style="margin:.25rem 0 0;padding-left:1.25rem;">
                  {% for field, errors in form.errors.items %}
                    <li style="margin-bottom:.25rem;"><strong>{{ field }}</strong>
                      <ul style="margin:.25rem 0 0;padding-left:1rem;">
                        {% for e in errors %}
                          <li>{{ e }}</li>
                        {% endfor %}
                      </ul>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
            
            <!-- Name Field -->
            <div class="form-group">
              <label for="{{ form.fullname.id_for_label }}" class="form-label">Full Name</label>
              <div class="input-container">
                <i class="fas fa-user input-icon"></i>
                {{ form.fullname }}
              </div>
            </div>

            <!-- Age and Enrollment Row -->
            <div class="form-row form-group">
              <div>
                <label for="{{ form.age.id_for_label }}" class="form-label">Age</label>
                <div class="input-container">
                  <i class="fas fa-calendar-days input-icon"></i>
                  {{ form.age }}
                </div>
              </div>
              <div>
                <label for="{{ form.enroll_no.id_for_label }}" class="form-label">Enrollment No.</label>
                <div class="input-container">
                  <i class="fas fa-id-card input-icon"></i>
                  {{ form.enroll_no }}
                </div>
              </div>
            </div>

            <!-- Department Field -->
            <div class="form-group">
              <label for="{{ form.department.id_for_label }}" class="form-label">Department</label>
              <div class="input-container">
                <i class="fas fa-building input-icon"></i>
                {{ form.department }}
                <i class="fas fa-chevron-down select-icon"></i>
              </div>
            </div>

            <!-- Date and Slot Row -->
            <div class="form-row form-group">
              <div>
                <label for="{{ form.date.id_for_label }}" class="form-label">Date</label>
                <div class="input-container">
                  <i class="fas fa-calendar input-icon"></i>
                  {{ form.date }}
                </div>
              </div>
              <div>
                <label for="{{ form.slot.id_for_label }}" class="form-label">Slot</label>
                <div class="input-container">
                  <i class="fas fa-clock input-icon"></i>
                  {{ form.slot }}
                  <i class="fas fa-chevron-down select-icon"></i>
                </div>
              </div>
            </div>

            <!-- Contact Info Row -->
            <div class="form-row form-group">
              <div>
                <label class="form-label">Phone Number</label>
                <div class="input-container with-prefix">
                  <span class="input-prefix">+91</span>
                  {{ form.phone }}
                </div>
              </div>
              <div>
                <label class="form-label">Email Address</label>
                <div class="input-container">
                  <i class="fas fa-envelope input-icon"></i>
                  {{ form.email }}
                </div>
              </div>
            </div>

            <!-- Reason Checkboxes -->
            <div class="form-group" style="margin-bottom: 2rem;">
              <label class="form-label" style="margin-bottom: 1rem;">Reason for Appointment</label>
              <div class="checkbox-group">
                {% for radio in form.reason %}
                  <label class="checkbox-item">
                    {{ radio.tag }}
                    <div class="checkbox-custom">
                      <i class="fas fa-check checkbox-icon"></i>
                    </div>
                    <span class="checkbox-label">{{ radio.choice_label }}</span>
                  </label>
                {% endfor %}
              </div>
            </div>

            <!-- Admin Section -->
            <div class="admin-section">
              <h4>
                <i class="fas fa-user-shield"></i>
                Admin Controls
              </h4>
              
              <!-- Status and Remarks Row -->
              <div class="form-row form-group">
                <div>
                  <label for="edit-status" class="form-label">Status</label>
                  <div class="input-container">
                    <i class="fas fa-flag input-icon"></i>
                    {{ form.status }}
                    <i class="fas fa-chevron-down select-icon"></i>
                  </div>
                </div>
                <div>
                  <label for="edit-remarks" class="form-label">Remarks</label>
                  <div class="input-container">
                    <textarea id="id_remarks" name="remarks" class="form-textarea" placeholder="Add any remarks or notes..." rows="3"></textarea>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" name="delete" value="1" class="btn btn-danger" id="deleteBtn" style="margin-left: .5rem; background:#ef4444; color:white; border:none; padding:.6rem 1rem; border-radius:.5rem;">
              <i class="fas fa-trash" style="margin-right: .5rem;"></i>
              Delete
            </button>
            <button type="button" class="btn btn-cancel" id="cancelBtn">Cancel</button>
            <button type="submit" class="btn btn-save">
              <i class="fas fa-save" style="margin-right: 0.5rem;"></i>
              Save Changes
            </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  <script src="{% static 'js/admin/find-appointment.js' %}"></script>
  {% endblock %}
</body>
